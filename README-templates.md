# Система шаблонов конфигураций

## Описание

Система шаблонов позволяет создавать пользовательские конфигурации душевых кабин с произвольными полями и настройками. Это позволяет поддерживать уникальные типы кабин: трапециевидные, Г-образные, с полками и другие.

## Возможности

### Типы конфигураций

- **Прямые** (straight) - стандартные прямые кабины
- **Угловые** (corner) - угловые кабины
- **Уникальные** (unique) - полностью кастомные конфигурации
- **Пользовательские** (custom) - настраиваемые шаблоны

### Поля шаблонов

- **Текстовые поля** - для названий, описаний
- **Числовые поля** - для размеров в мм
- **Выпадающие списки** - для выбора из заданных опций

### Детальная настройка стекол

- **Индивидуальные размеры** - для каждого стекла отдельно
- **Типы стекол** - стационар, распашная дверь, раздвижная дверь
- **Автоматические корректировки** - размеры дверей уменьшаются автоматически
- **Опция порожка** - для распашных дверей с дополнительным уменьшением
- **Привязка к полям** - размеры берутся из заполненных полей шаблона

### Настройки шаблона

- **Количество стекол** - от 1 до 10
- **Конфигурация стекол** - индивидуальные настройки для каждого стекла
- **Типы стекол** - Стационар, Дверь распашная, Дверь раздвижная
- **Автоматические корректировки размеров** - настраиваемые значения
- **Опция нестандартного цвета** - включить/выключить
- **Фурнитура по умолчанию** - автоматически добавляются при выборе шаблона
- **Услуги по умолчанию** - автоматически добавляются при выборе шаблона

## Использование

### Создание шаблона в админке

1. Перейдите в **Админ панель → Шаблоны**
2. Нажмите **"Добавить шаблон"**
3. Заполните основные поля:

   - Название (например, "Трапеция")
   - Описание (необязательно)
   - Тип конфигурации
   - Количество стекол

4. Добавьте поля конфигурации:

   - Имя поля (например, "width_top")
   - Метка для пользователя ("Ширина верх (мм)")
   - Тип поля (текст, число, выбор)
   - Обязательность

5. Выберите фурнитуру по умолчанию:

   - Выберите позиции из списка доступной фурнитуры компании
   - Указанная фурнитура будет автоматически добавлена при выборе шаблона
   - Пользователь сможет изменить количество или удалить позиции

6. Выберите услуги по умолчанию:

   - Выберите услуги из списка доступных услуг компании
   - Указанные услуги будут автоматически добавлены при выборе шаблона
   - Пользователь сможет убрать услуги если они не нужны

7. Настройте дополнительные опции:

   - Включить опцию нестандартного цвета при необходимости

8. Настройте конфигурацию стекол:

   Для каждого стекла из заданного количества настройте:

   - **Название** - отображаемое имя стекла (например, "Створка 1", "Стационар левый")
   - **Тип стекла**:
     - _Стационар_ - неподвижное стекло
     - _Дверь распашная_ - с возможностью добавления порожка (-15мм дополнительно)
     - _Дверь раздвижная_ - без опции порожка
   - **Поле ширины** - привязка к полю из шаблона для автоматического расчета
   - **Поле высоты** - привязка к полю из шаблона для автоматического расчета

9. Настройте автоматические корректировки размеров:

   - **Уменьшение высоты двери** - на сколько мм уменьшать высоту для дверей (по умолчанию 8мм)
   - **Уменьшение для порожка** - дополнительное уменьшение для распашных дверей с порожком (по умолчанию 15мм)

10. Настройте дополнительные опции:

    - Включить опцию нестандартного цвета при необходимости

11. Сохраните шаблон

### Использование в калькуляторе

1. В форме калькулятора выберите конфигурацию
2. В выпадающем списке появится группа **"Пользовательские шаблоны"**
3. Выберите нужный шаблон
4. Заполните поля шаблона согласно конфигурации
5. **Укажите размеры для каждого стекла:**
   - Для каждого настроенного стекла появятся отдельные поля ширины и высоты
   - Для распашных дверей доступна опция "С порожком"
   - Система автоматически применит корректировки размеров согласно типу стекла
6. Выберите цвет стекла, толщину, цвет фурнитуры
7. При необходимости отметьте "Нестандартный цвет" (если включено в шаблоне)
8. Добавьте/уберите фурнитуру и услуги (уже предустановлены согласно шаблону)

## Примеры шаблонов

### Трапеция

- **Поля**: Ширина верх, Ширина низ, Высота, Глубина
- **Стекол**: 3
- **Конфигурация стекол**:
  - Стекло боковое левое (Стационар, ширина=ширина_верх, высота=высота)
  - Стекло боковое правое (Стационар, ширина=ширина_низ, высота=высота)
  - Стекло фронтальное (Дверь распашная, ширина=глубина, высота=высота)
- **Корректировки**: -8мм для двери, -15мм для порожка
- **Нестандартный цвет**: Да
- **Фурнитура по умолчанию**: Профиль, Крепеж, Уплотнитель
- **Услуги по умолчанию**: Замер, Доставка

### Г-образная кабина

- **Поля**: Сторона A, Сторона B, Высота
- **Стекол**: 2
- **Конфигурация стекол**:
  - Стекло сторона A (Дверь раздвижная, ширина=сторона_A, высота=высота)
  - Стекло сторона B (Дверь раздвижная, ширина=сторона_B, высота=высота)
- **Корректировки**: -8мм для двери
- **Нестандартный цвет**: Нет
- **Фурнитура по умолчанию**: Профиль угловой, Раздвижная система, Уплотнитель F
- **Услуги по умолчанию**: Замер

### Ниша с полкой

- **Поля**: Ширина, Высота, Глубина, Высота полки, Количество полок (выбор)
- **Стекол**: 4
- **Конфигурация стекол**:
  - Стекло фронтальное (Стационар, ширина=ширина, высота=высота)
  - Стекло левое (Стационар, ширина=глубина, высота=высота)
  - Стекло правое (Стационар, ширина=глубина, высота=высота)
  - Стекло полки (Стационар, ширина=ширина, высота=высота_полки)
- **Корректировки**: стандартные
- **Нестандартный цвет**: Да
- **Фурнитура по умолчанию**: Профиль, Крепеж полки, Уплотнитель
- **Услуги по умолчанию**: Установка

### Складная дверь

- **Поля**: Общая ширина, Высота, Тип складывания (выбор)
- **Стекол**: 2
- **Конфигурация стекол**:
  - Створка 1 (Дверь распашная, ширина=общая_ширина, высота=высота)
  - Створка 2 (Дверь распашная, ширина=общая_ширина, высота=высота)
- **Корректировки**: -10мм для двери, -15мм для порожка
- **Нестандартный цвет**: Нет
- **Фурнитура по умолчанию**: Складная фурнитура, Профиль, Уплотнитель
- **Услуги по умолчанию**: Замер, Установка

## Демонстрационные данные

Для создания демонстрационных шаблонов запустите:

```bash
cd backend
node src/scripts/seedTemplates.js
```

Это создаст 4 готовых шаблона для тестирования системы.

## Технические детали

### Backend

- Модель `Template` в MongoDB
- API роуты `/api/templates`
- Контроллер `templateController`

### Frontend

- Компонент `TemplatesTab` для управления в админке
- Интеграция с `CalculatorForm`
- Динамическое отображение полей шаблона

### Расчеты

- Система автоматически рассчитывает площадь стекла
- Учитывает количество стекол из шаблона
- Применяет цены из админки на стекло и фурнитуру
- Добавляет услуги и наценки согласно настройкам
