# Модуль Аналитики для Калькулятора Стекла

## Описание

Модуль аналитики предоставляет возможность анализа данных по расчётам и заказам стеклянных душевых кабин, перегородок и других конструкций для принятия управленческих решений.

## Доступ

- **Пользователи**: Admin, Superadmin
- **Путь**: `/analytics`
- **Навигация**: Кнопка "Аналитика" в главном меню

## Основной функционал

### 1. Отчёт по продажам и выручке

- Общая сумма заказов за выбранный период
- Количество завершённых проектов (всех либо по конфигурациям)
- Средняя сумма заказа, средняя сумма выручки
- График выручки по дням
- Конверсия: расчеты → заказы
- Выручка по конфигурациям

### 2. Анализ популярных конфигураций

- Частота использования типов конструкций
- Популярные цвета стекла и толщины
- Популярные цвета фурнитуры
- Средние размеры изделий
- Популярные комбинации (стекло + фурнитура)

### 3. Финансовая аналитика

- Расчет себестоимости проекта (материалы + фурнитура)
- Выручка - себестоимость = маржа
- Отчет по наценке в процентах
- Маржинальность по конфигурациям

### 4. Производственная нагрузка

- Количество проектов в каждом статусе
- История статусов проектов по времени
- График загруженности по неделям
- Среднее время проектов в статусах

## API Endpoints

### Backend Routes (`/api/analytics`)

- `GET /sales` - Отчёт по продажам
- `GET /configurations` - Анализ конфигураций
- `GET /financial` - Финансовая аналитика
- `GET /production-load` - Производственная нагрузка
- `GET /export` - Данные для экспорта

### Параметры запросов

- `companyId` (обязательный) - ID компании
- `startDate` (опциональный) - Дата начала периода
- `endDate` (опциональный) - Дата окончания периода
- `configuration` (опциональный) - Фильтр по конфигурации

## Фильтры и настройки

### Временные фильтры

- Выбор даты начала и окончания
- Фильтр по конфигурациям:
  - Стационарное стекло
  - Прямая раздвижная
  - Угловая раздвижная
  - Уникальная конфигурация
  - Перегородка

### Экспорт данных

- Кнопка "Экспорт" для выгрузки данных в JSON формате
- Включает все данные текущего отчёта с фильтрами

## UI/UX

### Вкладки

1. **Продажи** - Метрики продаж и графики выручки
2. **Конфигурации** - Анализ популярности конфигураций
3. **Финансы** - Маржинальность и себестоимость
4. **Нагрузка** - Производственные метрики

### Графики и визуализация

- Линейные графики для выручки по времени
- Столбчатые диаграммы для сравнения показателей
- Круговые диаграммы для распределения
- Карточки с ключевыми метриками

## Техническая реализация

### Frontend

- **Файл**: `frontend/src/pages/AnalyticsPage.tsx`
- **Библиотека графиков**: Recharts
- **Типизация**: TypeScript интерфейсы для всех данных
- **Стилизация**: Inline styles с адаптивностью

### Backend

- **Контроллер**: `backend/src/controllers/analyticsController.js`
- **Маршруты**: `backend/src/routes/analyticsRoutes.js`
- **База данных**: MongoDB через Mongoose
- **Аутентификация**: JWT токены

### Модели данных

Использует существующие модели:

- `Project` - основные данные проектов
- `Status` - статусы проектов
- `User` - пользователи (менеджеры)

## Установка и настройка

### Зависимости

Frontend требует установки библиотеки графиков:

```bash
cd frontend
npm install recharts
```

### Конфигурация

1. Убедитесь, что backend содержит аналитические маршруты
2. Проверьте доступность MongoDB
3. Убедитесь в наличии тестовых данных проектов

## Безопасность

- Все эндпоинты требуют аутентификации
- Доступ только для ролей `admin` и `superadmin`
- Фильтрация данных по компании пользователя

## Возможности расширения

### Дополнительные метрики

- Анализ сезонности продаж
- Прогнозирование выручки
- Анализ эффективности менеджеров
- Географический анализ заказов

### Улучшения экспорта

- Экспорт в Excel формат
- Экспорт в PDF с графиками
- Автоматические отчёты по расписанию
- Email рассылка отчётов

### Интерактивность

- Drill-down в графиках
- Фильтры по менеджерам
- Сравнение периодов
- Настраиваемые дашборды

## Примеры использования

### Анализ эффективности

1. Выберите период (например, последний месяц)
2. Перейдите на вкладку "Финансы"
3. Проанализируйте маржинальность по конфигурациям
4. Определите наиболее прибыльные типы заказов

### Планирование производства

1. Откройте вкладку "Нагрузка"
2. Изучите распределение проектов по статусам
3. Проанализируйте среднее время в каждом статусе
4. Оптимизируйте процессы с учётом узких мест

### Маркетинговые решения

1. Перейдите на вкладку "Конфигурации"
2. Изучите популярные комбинации стекла и фурнитуры
3. Проанализируйте средние размеры изделий
4. Адаптируйте предложения под востребованные решения
